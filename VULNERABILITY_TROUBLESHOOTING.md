# Vulnerability Troubleshooting Guide

This document provides detailed troubleshooting guidance for npm audit vulnerabilities found in the App-Entretelas project.

## Quick Reference

```bash
# Check production dependencies only (what ships to users)
npm audit --omit=dev

# Check all dependencies (including dev tools)
npm audit

# Attempt automatic fixes (non-breaking changes only)
npm audit fix

# Force fixes with breaking changes (NOT RECOMMENDED without testing)
npm audit fix --force
```

## Current Status

**Last Updated:** 2026-02-19

**Total Vulnerabilities:** 36 (7 moderate, 29 high)

- **Production:** 1 moderate (accepted)
- **Development:** 35 (7 moderate, 28 high) - all accepted

## Vulnerability Breakdown

### Production Dependencies (Ships to End Users)

#### 1. electron <35.7.5 (Moderate)

**Vulnerability:** ASAR Integrity Bypass via resource modification
**Advisory:** https://github.com/advisories/GHSA-vmqv-hx8q-j7mg

**Current Version:** electron@30.5.1

**Impact:**

- Requires local file system access to exploit
- Attacker would need to modify application files on disk

**Why Not Fixed:**

- Electron 30.x is required for compatibility with better-sqlite3 and other native modules
- Upgrading to 35.7.5+ would be a breaking change requiring extensive testing
- Application targets trusted Windows 10+ machines with proper file permissions
- Risk is mitigated by OS-level file access controls

**Recommended Action:** ACCEPTED - Monitor for future updates when planning major version upgrade

**Future Mitigation Path:**

1. Plan migration to Electron 35+ in a dedicated release cycle
2. Test compatibility with all native modules (especially better-sqlite3)
3. Verify all IPC handlers and Electron APIs work correctly
4. Update SECURITY.md when upgrade is complete

---

### Development Dependencies (Does NOT Ship to Users)

These vulnerabilities only affect the development environment and build process. They do not impact the security of the distributed application.

#### 2. ajv <8.18.0 (Moderate)

**Vulnerability:** ReDoS when using `$data` option
**Advisory:** https://github.com/advisories/GHSA-2g4f-4pwh-qvx6

**Current Version:** ajv@6.12.6 (various locations in dependency tree)

**Affected Packages:**

- @eslint/eslintrc (via eslint)
- @develar/schema-utils (via electron-builder)
- ajv-keywords
- dmg-license

**Impact:**

- Regular Expression Denial of Service (ReDoS)
- Only affects JSON schema validation during development/build
- No user input goes through ajv in this project

**Why Not Fixed:**

- Only used in development tooling (ESLint, electron-builder)
- Fixing requires `npm audit fix --force` → ESLint 10.x (breaking changes)
- ESLint 8.x is still maintained and sufficient for project needs
- ajv processes developer-controlled schemas, not untrusted input

**Recommended Action:** ACCEPTED - Update when ESLint 10+ migration is planned

**How to Fix (when ready):**

```bash
# This will upgrade ESLint to 10.x with breaking changes
npm audit fix --force

# Alternative: Manual upgrade
npm install eslint@^10.0.0 --save-dev
npm install eslint-plugin-import@latest --save-dev
npm install eslint-plugin-jsx-a11y@latest --save-dev
npm install eslint-plugin-react@latest --save-dev
npm run lint  # Test for breaking changes
```

#### 3. esbuild <=0.24.2 (Moderate)

**Vulnerability:** Dev server accepts requests from any website
**Advisory:** https://github.com/advisories/GHSA-67mh-4wv8-2f99

**Current Version:** esbuild@0.21.5 (via vite)

**Impact:**

- Only affects Vite development server (`npm run dev`)
- Malicious website could potentially read dev server responses
- Does not affect production builds

**Why Not Fixed:**

- Only impacts local development environment
- Requires developer to visit malicious website while dev server is running
- Fixing requires `npm audit fix --force` → Vite 7.x (breaking changes)
- Vite 5.x is stable and meets all project requirements

**Recommended Action:** ACCEPTED - Developers should only run dev server on trusted networks

**Mitigation for Developers:**

- Only run `npm run dev` on trusted local networks
- Don't visit untrusted websites while dev server is running
- Use firewall rules to restrict dev server access if concerned

**How to Fix (when ready):**

```bash
# This will upgrade Vite to 7.x with potential breaking changes
npm audit fix --force

# Alternative: Manual upgrade
npm install vite@^7.0.0 --save-dev
npm run dev  # Test for breaking changes
npm run build  # Verify builds still work
```

#### 4. minimatch <10.2.1 (High)

**Vulnerability:** ReDoS via repeated wildcards with non-matching literal
**Advisory:** https://github.com/advisories/GHSA-3ppc-4f35-3m26

**Current Version:** Various versions <10.2.1 in dependency trees

**Affected Packages (29 instances):**

- glob (multiple versions)
- @electron/asar
- @electron/universal
- @eslint/eslintrc
- @humanwhocodes/config-array
- cacache
- dir-compare
- eslint-plugin-import
- eslint-plugin-jsx-a11y
- eslint-plugin-react
- filelist → jake → ejs
- rimraf
- flat-cache → file-entry-cache
- temp
- electron-winstaller
- node-gyp → @electron/rebuild

**Impact:**

- Regular Expression Denial of Service in file pattern matching
- Only used during development and build processes
- Patterns are developer-defined, not user-provided

**Why Not Fixed:**

- Transitive dependency in many build tools
- Requires multiple breaking changes across the toolchain
- Patterns come from developer code (package.json, build configs), not user input
- Risk of ReDoS is minimal in controlled development environment

**Recommended Action:** ACCEPTED - Update during next major toolchain upgrade

**How to Fix (when ready):**

```bash
# This will upgrade multiple packages with breaking changes
npm audit fix --force

# Verify key tools still work
npm run lint
npm run build
npm run test
npm run dist  # Test electron-builder
```

## Understanding npm audit Output

### Severity Levels

- **Critical:** Immediate action recommended
- **High:** Review and plan to fix
- **Moderate:** Fix when feasible
- **Low:** Fix during routine maintenance

### Production vs Development

```bash
# This is what matters for end users
npm audit --omit=dev

# This includes dev tools (ESLint, Vite, electron-builder, etc.)
npm audit
```

**Key Point:** If `npm audit --omit=dev` shows vulnerabilities, those affect your users. If only `npm audit` shows them, they only affect developers.

## Decision Matrix

| Dependency Type | Severity      | User Impact | Action                        |
| --------------- | ------------- | ----------- | ----------------------------- |
| Production      | Critical/High | Direct      | Fix immediately               |
| Production      | Moderate      | Direct      | Fix when feasible             |
| Development     | Any           | None        | Accept or fix when convenient |

## Common Questions

### Q: Why not just run `npm audit fix --force`?

**A:** Because it will:

1. Upgrade ESLint 8.x → 10.x (breaking changes in config and rules)
2. Upgrade Vite 5.x → 7.x (potential breaking changes in build)
3. Upgrade Electron 30.x → 40.x (major breaking changes, native module recompilation)
4. May break existing linting rules, build scripts, and Electron APIs
5. Requires extensive testing to ensure nothing breaks

### Q: Are these vulnerabilities a security risk for users?

**A:** No, with one exception:

- **electron@30.5.1** (production): Moderate risk, accepted due to compatibility needs
- **All other 35 vulnerabilities** (development): Zero risk to users - not included in distributed app

### Q: Should I be worried about the "29 high severity" count?

**A:** No, because:

1. All 29 high severity issues are in development dependencies
2. They don't ship with the application
3. They affect build-time tools with developer-controlled inputs
4. The high count is due to transitive dependencies (one vulnerable package affects many others)

### Q: When should these be fixed?

**A:** During planned major version upgrades:

- **Electron:** When planning migration to Electron 35+ (requires native module testing)
- **ESLint:** When ready to adopt ESLint 10.x (requires config updates)
- **Vite:** When ready to adopt Vite 7.x (requires testing dev/build process)

### Q: How can I verify the app is secure?

**A:** Check production dependencies only:

```bash
npm audit --omit=dev
```

If this shows only the accepted electron vulnerability, the app is secure.

## Monitoring and Updates

### Monthly Security Review

Run these commands and compare with this document:

```bash
npm audit --omit=dev  # Should show only electron vulnerability
npm audit              # Should show 36 vulnerabilities
```

### When to Update This Document

- New vulnerabilities are discovered
- Packages are upgraded
- Risk assessments change
- After any security-related changes

### CI/CD Integration

The project uses `.npmrc` with `audit-level=moderate` to fail CI on moderate+ vulnerabilities. This ensures:

- Production vulnerabilities are caught early
- Accepted risks are explicitly documented
- New vulnerabilities trigger review

## For Auditors and Security Teams

### Risk Summary

**Production Attack Surface:**

- 1 moderate vulnerability in electron (local file system access required)
- Mitigated by OS file permissions and trusted deployment environment

**Development Attack Surface:**

- 35 vulnerabilities in dev tools
- Zero impact on distributed application
- Build process occurs on trusted developer machines

### Compliance Notes

- All vulnerabilities have been reviewed and documented
- Risk acceptance is based on impact assessment and cost-benefit analysis
- Regular monitoring is in place via `npm run audit:security`
- Update path is documented for each vulnerability

### Recommended Actions for Auditors

1. Verify `npm audit --omit=dev` shows only documented production vulnerabilities
2. Review risk acceptance justifications in SECURITY.md
3. Confirm development occurs in controlled environment
4. Validate that development dependencies don't ship with the app (check dist/ build output)

## Additional Resources

- **Project Security Policy:** [SECURITY.md](./SECURITY.md)
- **npm audit documentation:** https://docs.npmjs.com/cli/v10/commands/npm-audit
- **NIST CVE Database:** https://nvd.nist.gov/
- **GitHub Security Advisories:** https://github.com/advisories

## Contact

For questions about this vulnerability assessment, please:

1. Review [SECURITY.md](./SECURITY.md) for the complete security policy
2. Open an issue on GitHub for clarifications
3. Create a security advisory for new vulnerabilities
